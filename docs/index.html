<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡åŒ–å›æµ‹æ•°æ®ä¸­å¿ƒ</title>
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
            background: #f5f5f5;
        }
        
        /* é¡¶éƒ¨å¯¼èˆªæ  */
        .nav-bar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            position: relative;
        }
        
        .nav-bar.collapsed {
            padding: 10px 20px;
        }
        
        .nav-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .nav-bar h1 {
            font-size: 24px;
        }
        
        .nav-toggle {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
            transition: background 0.3s;
        }
        
        .nav-toggle:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .nav-tabs {
            display: flex;
            gap: 20px;
            margin-top: 10px;
            flex-wrap: wrap;
            transition: all 0.3s ease;
            overflow: hidden;
        }
        
        .nav-bar.collapsed .nav-tabs {
            height: 0;
            margin: 0;
            opacity: 0;
        }
        
        .nav-tab {
            padding: 8px 16px;
            background: rgba(255,255,255,0.2);
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
            user-select: none;
        }
        
        .nav-tab:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .nav-tab.active {
            background: white;
            color: #667eea;
            font-weight: bold;
        }
        
        /* ä¸»ä½“å®¹å™¨ */
        .main-container {
            flex: 1;
            display: flex;
            overflow: hidden;
            height: calc(100vh - 100px);
            transition: height 0.3s ease;
        }
        
        .nav-bar.collapsed + .main-container {
            height: calc(100vh - 50px);
        }
        
        /* å·¦ä¾§å†å²è®°å½• */
        .sidebar {
            width: 350px;
            background: white;
            border-right: 1px solid #e0e0e0;
            overflow-y: auto;
            padding: 20px;
            transition: margin-left 0.3s ease, width 0.3s ease;
            position: relative;
        }
        
        .sidebar.collapsed {
            width: 50px;
            padding: 20px 5px;
            overflow: visible;
        }
        
        .sidebar-toggle {
            position: absolute;
            right: 10px;
            top: 20px;
            background: #667eea;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .sidebar-toggle:hover {
            background: #764ba2;
            transform: scale(1.1);
        }
        
        .sidebar.collapsed .sidebar-toggle {
            right: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        
        .sidebar-content {
            transition: opacity 0.3s ease;
        }
        
        .sidebar.collapsed .sidebar-content {
            opacity: 0;
            pointer-events: none;
        }
        
        .sidebar h2 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #333;
        }
        
        /* ç­–ç•¥ç»„å®¹å™¨ */
        .strategy-group {
            margin-bottom: 20px;
        }
        
        .strategy-group-title {
            font-size: 14px;
            font-weight: bold;
            color: #666;
            padding: 8px 12px;
            background: #f0f0f0;
            border-radius: 8px 8px 0 0;
            display: flex;
            align-items: center;
            cursor: pointer;
            user-select: none;
        }
        
        .strategy-group-title:hover {
            background: #e8e8e8;
        }
        
        .strategy-group-title .arrow {
            margin-right: 8px;
            transition: transform 0.3s;
        }
        
        .strategy-group.collapsed .arrow {
            transform: rotate(-90deg);
        }
        
        .strategy-group-content {
            border: 1px solid #e0e0e0;
            border-radius: 0 0 8px 8px;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .strategy-group.collapsed .strategy-group-content {
            max-height: 0;
            border: none;
        }
        
        .history-item {
            padding: 12px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 1px solid #f0f0f0;
            position: relative;
        }
        
        .history-item:last-child {
            border-bottom: none;
        }
        
        .history-item.sub-strategy {
            padding-left: 32px;
            font-size: 14px;
        }
        
        .history-item.sub-strategy::before {
            content: "â””";
            position: absolute;
            left: 12px;
            top: 12px;
            color: #999;
        }
        
        .history-item:hover {
            background: #f8f9fa;
        }
        
        .history-item.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .history-item.main-strategy {
            font-weight: bold;
            background: #f8f9fa;
        }
        
        .history-item.main-strategy.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .history-item .date {
            font-size: 12px;
            opacity: 0.8;
            margin-top: 5px;
        }
        
        .history-item .metrics {
            font-size: 11px;
            margin-top: 8px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .history-item .metric-item {
            display: flex;
            flex-direction: column;
        }
        
        .history-item .metric-label {
            opacity: 0.7;
        }
        
        .history-item .metric-value {
            font-weight: bold;
        }
        
        .history-item .weight {
            display: inline-block;
            margin-left: 8px;
            padding: 2px 6px;
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
        }
        
        .history-item.active .weight {
            background: rgba(255,255,255,0.2);
            color: white;
        }
        
        /* å³ä¾§å†…å®¹åŒº */
        .content {
            flex: 1;
            padding: 20px;
            overflow: hidden;
            background: white;
            margin: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            position: relative;
            display: flex;
            flex-direction: column;
        }
        
        .content iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 8px;
        }
        
        .csv-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .csv-table th, .csv-table td {
            padding: 10px;
            border: 1px solid #e0e0e0;
            text-align: left;
        }
        
        .csv-table th {
            background: #f8f9fa;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .csv-table tr:hover {
            background: #f8f9fa;
        }
        
        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }
        
        .empty-state h3 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        /* å¿«æ·é”®æç¤º */
        .shortcuts-hint {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            z-index: 1000;
        }
        
        .shortcuts-hint.show {
            opacity: 1;
        }
        
        /* ç§»åŠ¨ç«¯èœå•æŒ‰é’® */
        .menu-toggle-mobile {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            z-index: 2000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            font-size: 24px;
        }
        
        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 768px) {
            .main-container {
                height: calc(100vh - 80px);
            }
            
            .nav-bar.collapsed + .main-container {
                height: calc(100vh - 50px);
            }
            
            .sidebar {
                position: fixed;
                left: -320px;
                top: 0;
                height: 100vh;
                z-index: 1000;
                transition: left 0.3s ease;
                box-shadow: 2px 0 10px rgba(0,0,0,0.1);
                width: 320px;
            }
            
            .sidebar.collapsed {
                margin-left: 0;
                width: 320px;
                padding: 20px;
            }
            
            .sidebar.open {
                left: 0;
            }
            
            .sidebar-toggle {
                display: none;
            }
            
            .menu-toggle-mobile {
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .content {
                margin: 10px;
            }
            
            .nav-tabs {
                flex-wrap: nowrap;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                padding-bottom: 5px;
            }
            
            .nav-tab {
                flex-shrink: 0;
            }
            
            .nav-header h1 {
                font-size: 18px;
            }
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .loading {
            text-align: center;
            padding: 40px;
        }
        
        .loading::after {
            content: 'åŠ è½½ä¸­...';
            display: inline-block;
            animation: dots 1.5s steps(4, end) infinite;
        }
        
        @keyframes dots {
            0%, 20% {
                content: 'åŠ è½½ä¸­';
            }
            40% {
                content: 'åŠ è½½ä¸­.';
            }
            60% {
                content: 'åŠ è½½ä¸­..';
            }
            80%, 100% {
                content: 'åŠ è½½ä¸­...';
            }
        }
        
        /* é®ç½©å±‚ï¼ˆç§»åŠ¨ç«¯ï¼‰ */
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }
        
        .overlay.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="nav-bar" id="nav-bar">
        <div class="nav-header">
            <h1>é‡åŒ–å›æµ‹æ•°æ®ä¸­å¿ƒ</h1>
            <button class="nav-toggle" onclick="toggleNav()" title="æ”¶èµ·/å±•å¼€å¯¼èˆª">â–¼</button>
        </div>
        <div class="nav-tabs">
            <div class="nav-tab active" data-category="fund_curve">èµ„é‡‘æ›²çº¿</div>
            <div class="nav-tab" data-category="strategy_eval">ç­–ç•¥è¯„ä»·</div>
            <div class="nav-tab" data-category="yearly_return">å¹´åº¦æ”¶ç›Š</div>
            <div class="nav-tab" data-category="monthly_return">æœˆåº¦æ”¶ç›Š</div>
            <div class="nav-tab" data-category="quarterly_return">å­£åº¦æ”¶ç›Š</div>
            <div class="nav-tab" data-category="config">ç­–ç•¥é…ç½®</div>
            <div class="nav-tab" data-category="download">ä¸‹è½½å®Œæ•´å›æµ‹æ•°æ®</div>
        </div>
    </div>
    
    <div class="main-container">
        <div class="sidebar" id="sidebar">
            <button class="sidebar-toggle" onclick="toggleSidebar()" title="æ”¶èµ·/å±•å¼€ä¾§è¾¹æ ">â—€</button>
            <div class="sidebar-content">
                <h2>å†å²è®°å½•</h2>
                <div id="history-list">
                    <div class="loading"></div>
                </div>
            </div>
        </div>
        
        <div class="content" id="content">
            <div class="empty-state">
                <h3>è¯·é€‰æ‹©å†å²è®°å½•</h3>
                <p>ä»å·¦ä¾§åˆ—è¡¨é€‰æ‹©è¦æŸ¥çœ‹çš„å›æµ‹è®°å½•</p>
            </div>
        </div>
    </div>
    
    <div class="overlay" id="overlay" onclick="toggleMobileSidebar()"></div>
    <button class="menu-toggle-mobile" id="menu-toggle-mobile" onclick="toggleMobileSidebar()">â˜°</button>
    
    <div class="shortcuts-hint" id="shortcuts-hint">
        å¿«æ·é”®: [N] å¯¼èˆªæ  | [S] ä¾§è¾¹æ  | [â†‘â†“] åˆ‡æ¢è®°å½•
    </div>
    
    <script>
        // GitHub ä»“åº“é…ç½®
        const GITHUB_CONFIG = {
            owner: 'YOUR_GITHUB_USERNAME',  // æ›¿æ¢ä¸ºä½ çš„ GitHub ç”¨æˆ·å
            repo: 'YOUR_REPO_NAME',          // æ›¿æ¢ä¸ºä½ çš„ä»“åº“å
            baseUrl: 'https://github.com'   // GitHub åŸºç¡€URL
        };
        
        let historyData = null;
        let currentRecord = null;
        let currentCategory = 'fund_curve';
        let allRecords = [];
        
        // åˆå§‹åŒ–
        async function init() {
            try {
                // åŠ è½½å†å²è®°å½•
                const response = await fetch('history.json');
                if (!response.ok) throw new Error('æ— æ³•åŠ è½½å†å²è®°å½•');
                
                historyData = await response.json();
                renderHistory();
                
                // é»˜è®¤åŠ è½½ç¬¬ä¸€ä¸ªç­–ç•¥
                if (allRecords.length > 0) {
                    loadRecord(allRecords[0].id);
                }
                
                // åˆå§‹åŒ–å¿«æ·é”®
                initKeyboardShortcuts();
                
                // æ¢å¤ç”¨æˆ·åå¥½è®¾ç½®
                restoreUserPreferences();
                
            } catch (error) {
                console.error('åˆå§‹åŒ–å¤±è´¥:', error);
                document.getElementById('history-list').innerHTML = 
                    '<div style="color: red; padding: 10px;">åŠ è½½å¤±è´¥: ' + error.message + '</div>';
            }
        }
        
        // åˆ‡æ¢å¯¼èˆªæ 
        function toggleNav() {
            const navBar = document.getElementById('nav-bar');
            const isCollapsed = navBar.classList.toggle('collapsed');
            const toggle = navBar.querySelector('.nav-toggle');
            toggle.textContent = isCollapsed ? 'â–¶' : 'â–¼';
            
            // ä¿å­˜ç”¨æˆ·åå¥½
            localStorage.setItem('navCollapsed', isCollapsed);
        }
        
        // åˆ‡æ¢ä¾§è¾¹æ 
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const isCollapsed = sidebar.classList.toggle('collapsed');
            const toggle = sidebar.querySelector('.sidebar-toggle');
            toggle.textContent = isCollapsed ? 'â–¶' : 'â—€';
            
            // ä¿å­˜ç”¨æˆ·åå¥½
            localStorage.setItem('sidebarCollapsed', isCollapsed);
        }
        
        // ç§»åŠ¨ç«¯åˆ‡æ¢ä¾§è¾¹æ 
        function toggleMobileSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            
            sidebar.classList.toggle('open');
            overlay.classList.toggle('show');
        }
        
        // æ¢å¤ç”¨æˆ·åå¥½è®¾ç½®
        function restoreUserPreferences() {
            // æ¢å¤å¯¼èˆªæ çŠ¶æ€
            if (localStorage.getItem('navCollapsed') === 'true') {
                const navBar = document.getElementById('nav-bar');
                navBar.classList.add('collapsed');
                navBar.querySelector('.nav-toggle').textContent = 'â–¶';
            }
            
            // æ¢å¤ä¾§è¾¹æ çŠ¶æ€ï¼ˆä»…æ¡Œé¢ç«¯ï¼‰
            if (window.innerWidth > 768 && localStorage.getItem('sidebarCollapsed') === 'true') {
                const sidebar = document.getElementById('sidebar');
                sidebar.classList.add('collapsed');
                sidebar.querySelector('.sidebar-toggle').textContent = 'â–¶';
            }
        }
        
        // åˆå§‹åŒ–é”®ç›˜å¿«æ·é”®
        function initKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                // å¿½ç•¥è¾“å…¥æ¡†ä¸­çš„æŒ‰é”®
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
                
                switch(e.key.toLowerCase()) {
                    case 'n':
                        toggleNav();
                        showShortcutHint();
                        break;
                    case 's':
                        if (window.innerWidth > 768) {
                            toggleSidebar();
                            showShortcutHint();
                        }
                        break;
                    case 'arrowup':
                        e.preventDefault();
                        const currentIndex = allRecords.findIndex(r => r.id === currentRecord?.id);
                        if (currentIndex > 0) {
                            loadRecord(allRecords[currentIndex - 1].id);
                        }
                        break;
                    case 'arrowdown':
                        e.preventDefault();
                        const idx = allRecords.findIndex(r => r.id === currentRecord?.id);
                        if (idx < allRecords.length - 1) {
                            loadRecord(allRecords[idx + 1].id);
                        }
                        break;
                    case '?':
                        showShortcutHint();
                        break;
                }
            });
        }
        
        // æ˜¾ç¤ºå¿«æ·é”®æç¤º
        function showShortcutHint() {
            const hint = document.getElementById('shortcuts-hint');
            hint.classList.add('show');
            setTimeout(() => {
                hint.classList.remove('show');
            }, 2000);
        }
        
        // æ¸²æŸ“å†å²è®°å½•åˆ—è¡¨
        function renderHistory() {
            const container = document.getElementById('history-list');
            
            if (!historyData.strategies || historyData.strategies.length === 0) {
                container.innerHTML = '<div style="padding: 10px; color: #999;">æš‚æ— å†å²è®°å½•</div>';
                return;
            }
            
            allRecords = [];
            let html = '';
            
            historyData.strategies.forEach(strategy => {
                // æ·»åŠ ç­–ç•¥ç»„
                html += `
                    <div class="strategy-group" id="group-${strategy.id}">
                        <div class="strategy-group-title" onclick="toggleGroup('${strategy.id}')">
                            <span class="arrow">â–¼</span>
                            <span>ğŸ“Š ${strategy.name}</span>
                        </div>
                        <div class="strategy-group-content" style="max-height: 1000px;">
                `;
                
                // æ·»åŠ ä¸»ç­–ç•¥
                allRecords.push(strategy);
                const mainMetrics = strategy.metrics || {};
                html += `
                    <div class="history-item main-strategy ${allRecords.length === 1 ? 'active' : ''}" 
                         onclick="loadRecord('${strategy.id}')"
                         data-id="${strategy.id}">
                        <div>æ€»ç­–ç•¥: ${strategy.name}</div>
                        <div class="date">${formatTimestamp(strategy.timestamp)}</div>
                        <div style="font-size: 11px; color: #888; margin: 5px 0;">
                            ğŸ“ æ•°æ®ç‰ˆæœ¬: ${strategy.timestamp}
                        </div>
                        <div class="metrics">
                            ${mainMetrics.total_return ? `
                                <div class="metric-item">
                                    <span class="metric-label">æ”¶ç›Š</span>
                                    <span class="metric-value">${mainMetrics.total_return > 0 ? '+' : ''}${mainMetrics.total_return.toFixed(2)}%</span>
                                </div>
                            ` : ''}
                            ${mainMetrics.max_drawdown ? `
                                <div class="metric-item">
                                    <span class="metric-label">å›æ’¤</span>
                                    <span class="metric-value">${mainMetrics.max_drawdown.toFixed(2)}%</span>
                                </div>
                            ` : ''}
                            ${mainMetrics.sharpe_ratio ? `
                                <div class="metric-item">
                                    <span class="metric-label">å¤æ™®</span>
                                    <span class="metric-value">${mainMetrics.sharpe_ratio.toFixed(2)}</span>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
                
                // æ·»åŠ å­ç­–ç•¥
                if (strategy.sub_strategies) {
                    strategy.sub_strategies.forEach(subStrategy => {
                        allRecords.push(subStrategy);
                        const subMetrics = subStrategy.metrics || {};
                        html += `
                            <div class="history-item sub-strategy" 
                                 onclick="loadRecord('${subStrategy.id}')"
                                 data-id="${subStrategy.id}">
                                <div>
                                    ${subStrategy.name}
                                    ${subMetrics.weight ? `<span class="weight">${(subMetrics.weight * 100).toFixed(1)}%</span>` : ''}
                                </div>
                                <div class="metrics">
                                    ${subMetrics.total_return ? `
                                        <div class="metric-item">
                                            <span class="metric-label">æ”¶ç›Š</span>
                                            <span class="metric-value">${subMetrics.total_return > 0 ? '+' : ''}${subMetrics.total_return.toFixed(2)}%</span>
                                        </div>
                                    ` : ''}
                                    ${subMetrics.max_drawdown ? `
                                        <div class="metric-item">
                                            <span class="metric-label">å›æ’¤</span>
                                            <span class="metric-value">${subMetrics.max_drawdown.toFixed(2)}%</span>
                                        </div>
                                    ` : ''}
                                    ${subMetrics.sharpe_ratio ? `
                                        <div class="metric-item">
                                            <span class="metric-label">å¤æ™®</span>
                                            <span class="metric-value">${subMetrics.sharpe_ratio.toFixed(2)}</span>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        `;
                    });
                }
                
                html += `
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // åˆ‡æ¢ç­–ç•¥ç»„å±•å¼€/æ”¶èµ·
        function toggleGroup(groupId) {
            const group = document.getElementById(`group-${groupId}`);
            if (group) {
                const content = group.querySelector('.strategy-group-content');
                const isCollapsed = group.classList.toggle('collapsed');
                if (isCollapsed) {
                    content.style.maxHeight = '0';
                } else {
                    content.style.maxHeight = '1000px';
                }
            }
        }
        
        // æ ¼å¼åŒ–æ—¶é—´æˆ³
        function formatTimestamp(timestamp) {
            // timestampæ ¼å¼: 20241204_153000
            const year = timestamp.substring(0, 4);
            const month = timestamp.substring(4, 6);
            const day = timestamp.substring(6, 8);
            const hour = timestamp.substring(9, 11);
            const minute = timestamp.substring(11, 13);
            
            return `${year}-${month}-${day} ${hour}:${minute}`;
        }
        
        // åŠ è½½è®°å½•
        function loadRecord(recordId) {
            // æŸ¥æ‰¾è®°å½•
            currentRecord = allRecords.find(r => r.id === recordId);
            if (!currentRecord) return;
            
            // æ›´æ–°é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.history-item').forEach(item => {
                item.classList.toggle('active', item.dataset.id === recordId);
            });
            
            // å¦‚æœä¾§è¾¹æ æ˜¯æ”¶èµ·çš„ï¼Œè‡ªåŠ¨å±•å¼€ï¼ˆå¯é€‰ï¼‰
            // const sidebar = document.getElementById('sidebar');
            // if (sidebar.classList.contains('collapsed')) {
            //     toggleSidebar();
            // }
            
            // æ˜¾ç¤ºå½“å‰åˆ†ç±»çš„å†…å®¹
            showCategory(currentCategory);
            
            // ç§»åŠ¨ç«¯è‡ªåŠ¨å…³é—­ä¾§è¾¹æ 
            if (window.innerWidth <= 768) {
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('overlay');
                sidebar.classList.remove('open');
                overlay.classList.remove('show');
            }
        }
        
        // æ˜¾ç¤ºåˆ†ç±»å†…å®¹
        async function showCategory(category) {
            currentCategory = category;
            
            // æ›´æ–°æ ‡ç­¾çŠ¶æ€
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.category === category);
            });
            
            if (!currentRecord) {
                return;
            }
            
            const contentDiv = document.getElementById('content');
            const files = currentRecord.files;
            
            // æ˜¾ç¤ºåŠ è½½ä¸­
            contentDiv.innerHTML = '<div class="loading"></div>';
            
            try {
                // æŸ¥æ‰¾å¯¹åº”åˆ†ç±»çš„æ–‡ä»¶
                if (category === 'config') {
                    // æ˜¾ç¤ºé…ç½®æ–‡ä»¶åˆ—è¡¨
                    const configFiles = files.config_files || [];
                    if (configFiles.length > 0) {
                        contentDiv.innerHTML = `
                            <h2>é…ç½®æ–‡ä»¶</h2>
                            <ul style="list-style: none; padding: 20px;">
                                ${configFiles.map(f => 
                                    `<li style="margin: 10px 0;">
                                        <a href="${currentRecord.data_path}/${f.path}" 
                                           target="_blank" 
                                           style="color: #667eea; text-decoration: none; font-size: 16px;">
                                           ğŸ“„ ${f.name}
                                        </a>
                                    </li>`
                                ).join('')}
                            </ul>
                        `;
                    } else {
                        contentDiv.innerHTML = '<div class="empty-state"><p>æ— é…ç½®æ–‡ä»¶</p></div>';
                    }
                    return;
                }
                
                // ä¸‹è½½å®Œæ•´å›æµ‹æ•°æ®
                if (category === 'download') {
                    // æŸ¥æ‰¾å¯¹åº”çš„ä¸»ç­–ç•¥
                    let mainStrategy = currentRecord;
                    if (currentRecord.type === 'sub') {
                        // å¦‚æœå½“å‰æ˜¯å­ç­–ç•¥ï¼Œæ‰¾åˆ°å…¶çˆ¶ç­–ç•¥
                        mainStrategy = historyData.strategies.find(s => s.id === currentRecord.parent_id);
                    }
                    
                    if (mainStrategy && mainStrategy.archive) {
                        const archive = mainStrategy.archive;
                        // æ„å»º GitHub Release ä¸‹è½½é“¾æ¥
                        const downloadUrl = `${GITHUB_CONFIG.baseUrl}/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/releases/download/latest/${archive.filename}`;
                        const sizeInMB = (archive.size / 1024 / 1024).toFixed(2);
                        
                        contentDiv.innerHTML = `
                            <div style="padding: 40px; text-align: center;">
                                <h2>ä¸‹è½½å®Œæ•´å›æµ‹æ•°æ®</h2>
                                <div style="margin: 30px 0; padding: 30px; background: #f8f9fa; border-radius: 10px;">
                                    <div style="font-size: 48px; margin-bottom: 20px;">ğŸ“¦</div>
                                    <h3 style="color: #333; margin-bottom: 10px;">${archive.filename}</h3>
                                    <p style="color: #666; margin-bottom: 20px;">æ–‡ä»¶å¤§å°: ${sizeInMB} MB</p>
                                    <p style="color: #666; margin-bottom: 30px;">
                                        åŒ…å«ç­–ç•¥: ${mainStrategy.name}<br>
                                        æ•°æ®ç‰ˆæœ¬: ${mainStrategy.timestamp}
                                    </p>
                                    <a href="${downloadUrl}" 
                                       target="_blank"
                                       style="display: inline-block; padding: 12px 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                                              color: white; text-decoration: none; border-radius: 5px; font-weight: bold; font-size: 16px;
                                              transition: transform 0.3s, box-shadow 0.3s;"
                                       onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 4px 15px rgba(0,0,0,0.2)';"
                                       onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='none';">
                                        ä¸‹è½½å‹ç¼©åŒ…
                                    </a>
                                </div>
                                <div style="margin-top: 30px; padding: 20px; background: #fff3cd; border-left: 4px solid #ffc107; border-radius: 5px;">
                                    <p style="color: #856404; text-align: left;">
                                        <strong>âš ï¸ é…ç½®æç¤ºï¼š</strong><br>
                                        å¦‚æœä¸‹è½½é“¾æ¥æ— æ•ˆï¼Œè¯·ä¿®æ”¹ index.html ä¸­çš„ GITHUB_CONFIGï¼š<br>
                                        <code style="background: #f8f9fa; padding: 2px 5px; border-radius: 3px;">
                                        owner: 'ä½ çš„GitHubç”¨æˆ·å', repo: 'ä½ çš„ä»“åº“å'
                                        </code>
                                    </p>
                                </div>
                            </div>
                        `;
                    } else {
                        contentDiv.innerHTML = `
                            <div class="empty-state">
                                <h3>æ— å¯ä¸‹è½½æ•°æ®</h3>
                                <p>å½“å‰ç­–ç•¥æ²¡æœ‰å½’æ¡£æ–‡ä»¶</p>
                            </div>
                        `;
                    }
                    return;
                }
                
                // æŸ¥æ‰¾HTMLæ–‡ä»¶ï¼ˆèµ„é‡‘æ›²çº¿ï¼‰
                if (category === 'fund_curve') {
                    const htmlFiles = files.html_files || [];
                    const htmlFile = htmlFiles.find(f => f.category === 'fund_curve');
                    
                    if (htmlFile) {
                        // ç›´æ¥åµŒå…¥HTMLæ–‡ä»¶ï¼Œä¸åšä»»ä½•ä¿®æ”¹
                        const fullPath = `${currentRecord.data_path}/${htmlFile.path}`;
                        console.log('Loading HTML:', fullPath);
                        contentDiv.innerHTML = `<iframe src="${fullPath}"></iframe>`;
                        return;
                    }
                }
                
                // æŸ¥æ‰¾CSVæ–‡ä»¶
                const csvFiles = files.csv_files || [];
                let csvFile = null;
                
                // æ ¹æ®categoryæŸ¥æ‰¾å¯¹åº”çš„CSVæ–‡ä»¶
                if (category === 'strategy_eval') {
                    csvFile = csvFiles.find(f => f.name === 'ç­–ç•¥è¯„ä»·.csv' || f.name.includes('ç­–ç•¥è¯„ä»·'));
                } else if (category === 'yearly_return') {
                    csvFile = csvFiles.find(f => f.name === 'å¹´åº¦è´¦æˆ·æ”¶ç›Š.csv' || f.name.includes('å¹´åº¦'));
                } else if (category === 'monthly_return') {
                    csvFile = csvFiles.find(f => f.name === 'æœˆåº¦è´¦æˆ·æ”¶ç›Š.csv' || f.name.includes('æœˆåº¦'));
                } else if (category === 'quarterly_return') {
                    csvFile = csvFiles.find(f => f.name === 'å­£åº¦è´¦æˆ·æ”¶ç›Š.csv' || f.name.includes('å­£åº¦'));
                }
                
                if (csvFile) {
                    // æ£€æŸ¥æ˜¯å¦æ˜¯å¤§æ–‡ä»¶ï¼ˆå¦‚èµ„é‡‘æ›²çº¿.csvï¼‰
                    if (csvFile.name === 'èµ„é‡‘æ›²çº¿.csv') {
                        contentDiv.innerHTML = `
                            <div class="empty-state">
                                <h3>æ–‡ä»¶è¿‡å¤§</h3>
                                <p>${csvFile.name} æ–‡ä»¶è¿‡å¤§ï¼Œè¯·æŸ¥çœ‹èµ„é‡‘æ›²çº¿HTMLå›¾è¡¨</p>
                            </div>
                        `;
                    } else {
                        // åŠ è½½å¹¶æ˜¾ç¤ºCSVè¡¨æ ¼
                        try {
                            const html = await loadCSV(`${currentRecord.data_path}/${csvFile.path}`);
                            contentDiv.innerHTML = `
                                <h2>${csvFile.name}</h2>
                                <div style="overflow: auto; height: 100%;">
                                    ${html}
                                </div>
                            `;
                        } catch (error) {
                            contentDiv.innerHTML = `
                                <div class="empty-state">
                                    <p>åŠ è½½CSVå¤±è´¥: ${error.message}</p>
                                </div>
                            `;
                        }
                    }
                } else {
                    contentDiv.innerHTML = `
                        <div class="empty-state">
                            <p>è¯¥åˆ†ç±»æš‚æ— æ•°æ®</p>
                        </div>
                    `;
                }
            } catch (error) {
                contentDiv.innerHTML = `
                    <div class="empty-state">
                        <p>åŠ è½½å¤±è´¥: ${error.message}</p>
                    </div>
                `;
            }
        }
        
        // åŠ è½½CSVå¹¶è½¬æ¢ä¸ºè¡¨æ ¼
        async function loadCSV(path) {
            const response = await fetch(path);
            if (!response.ok) {
                throw new Error('æ— æ³•åŠ è½½CSVæ–‡ä»¶');
            }
            
            const text = await response.text();
            const lines = text.trim().split('\n').filter(line => line.trim());
            
            if (lines.length === 0) {
                return '<div class="empty-state"><p>CSVæ–‡ä»¶ä¸ºç©º</p></div>';
            }
            
            // è§£æCSVï¼ˆå¤„ç†é€—å·åœ¨å¼•å·å†…çš„æƒ…å†µï¼‰
            const parseCSVLine = (line) => {
                const result = [];
                let current = '';
                let inQuotes = false;
                
                for (let i = 0; i < line.length; i++) {
                    const char = line[i];
                    
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        result.push(current.trim());
                        current = '';
                    } else {
                        current += char;
                    }
                }
                
                result.push(current.trim());
                return result;
            };
            
            const headers = parseCSVLine(lines[0]);
            const rows = lines.slice(1).map(line => parseCSVLine(line));
            
            // ç”Ÿæˆè¡¨æ ¼HTML
            let html = '<table class="csv-table"><thead><tr>';
            html += headers.map(h => `<th>${escapeHtml(h)}</th>`).join('');
            html += '</tr></thead><tbody>';
            
            html += rows.map(row => 
                '<tr>' + row.map(cell => `<td>${escapeHtml(cell)}</td>`).join('') + '</tr>'
            ).join('');
            
            html += '</tbody></table>';
            
            return html;
        }
        
        // HTMLè½¬ä¹‰
        function escapeHtml(unsafe) {
            return String(unsafe)
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }
        
        // ç»‘å®šå¯¼èˆªç‚¹å‡»äº‹ä»¶
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                showCategory(tab.dataset.category);
            });
        });
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>